"use strict";(self.webpackChunkphlow_docs=self.webpackChunkphlow_docs||[]).push([[120],{1285:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>h,frontMatter:()=>d,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"packages-and-modules/create-module","title":"Creating Your Own Module","description":"Phlow modules are written in Rust and compiled as shared libraries. Here\u2019s a real example of a simple log module that prints messages at various log levels.","source":"@site/docs/packages-and-modules/create-module.md","sourceDirName":"packages-and-modules","slug":"/packages-and-modules/create-module","permalink":"/docs/packages-and-modules/create-module","draft":false,"unlisted":false,"editUrl":"https://github.com/phlowdotdev/phlow/tree/main/site/docs/packages-and-modules/create-module.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Creating Your Own Module"},"sidebar":"docsSidebar","previous":{"title":"Module Types","permalink":"/docs/packages-and-modules/module-type"},"next":{"title":"OpenTelemetry","permalink":"/docs/opentelemetry"}}');var r=s(4848),l=s(8453);const d={sidebar_position:3,title:"Creating Your Own Module"},i=void 0,o={},c=[{value:"Cargo.toml",id:"cargotoml",level:3},{value:"src/lib.rs",id:"srclibrs",level:3},{value:"phlow.yaml",id:"phlowyaml",level:3},{value:"Object Schema",id:"object-schema",level:3}];function a(e){const n={a:"a",code:"code",h3:"h3",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["Phlow modules are written in Rust and compiled as shared libraries. Here\u2019s a real example of a simple ",(0,r.jsx)(n.strong,{children:"log module"})," that prints messages at various log levels."]}),"\n",(0,r.jsx)(n.h3,{id:"cargotoml",children:"Cargo.toml"}),"\n",(0,r.jsxs)(n.p,{children:["This file defines the module's metadata and dependencies. ",(0,r.jsx)(n.a,{href:"https://crates.io/crates/phlow-sdk",children:(0,r.jsx)(n.code,{children:"phlow-sdk"})})," is the core library for building Phlow modules, while ",(0,r.jsx)(n.code,{children:"log"})," and ",(0,r.jsx)(n.code,{children:"env_logger"})," are used for logging functionality."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",children:'[package]\nname = "log"\nversion = "0.1.0"\nedition = "2021"\n\n[dependencies]\nphlow-sdk = "0.1"\nlog = { version = "0.4" }\nenv_logger = { version = "0.11" }\n\n[lib]\nname = "log"\ncrate-type = ["cdylib"]\n\n'})}),"\n",(0,r.jsx)(n.h3,{id:"srclibrs",children:"src/lib.rs"}),"\n",(0,r.jsxs)(n.p,{children:["This file contains the main logic of the module. It listens for incoming messages and logs them based on their severity level. The ",(0,r.jsx)(n.code,{children:"log"})," module is defined with a ",(0,r.jsx)(n.code,{children:"log"})," function that takes a ",(0,r.jsx)(n.code,{children:"ModuleReceiver"})," as an argument. It initializes the logger and listens for incoming messages, logging them according to their specified log level."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",children:'use phlow_sdk::prelude::*;\n\ncreate_step!(log(rx));\n\n#[derive(Debug)]\nenum LogLevel {\n    Info,\n    Debug,\n    Warn,\n    Error,\n}\n\n#[derive(Debug)]\nstruct Log {\n    level: LogLevel,\n    message: String,\n}\n\nimpl From<&Value> for Log {\n    fn from(value: &Value) -> Self {\n        let level = match value.get("level") {\n            Some(level) => match level.to_string().as_str() {\n                "info" => LogLevel::Info,\n                "debug" => LogLevel::Debug,\n                "warn" => LogLevel::Warn,\n                "error" => LogLevel::Error,\n                _ => LogLevel::Info,\n            },\n            _ => LogLevel::Info,\n        };\n\n        let message = value.get("message").unwrap_or(&Value::Null).to_string();\n\n        Self { level, message }\n    }\n}\n\npub async fn log(rx: ModuleReceiver) -> Result<(), Box<dyn std::error::Error + Send + Sync>> {\n    env_logger::Builder::from_env(\n        env_logger::Env::new()\n            .default_filter_or("info")\n            .filter_or("PHLOW_LOG", "info"),\n    )\n    .init();\n\n    debug!("PHLOW_OTEL is set to false, using default subscriber");\n\n    listen!(rx, move |package: ModulePackage| async {\n        let value = package.input.unwrap_or(Value::Null);\n        let log = Log::from(&value);\n\n        match log.level {\n            LogLevel::Info => info!("{}", log.message),\n            LogLevel::Debug => debug!("{}", log.message),\n            LogLevel::Warn => warn!("{}", log.message),\n            LogLevel::Error => error!("{}", log.message),\n        }\n\n        sender_safe!(package.sender, Value::Null.into());\n    });\n\n    Ok(())\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"phlowyaml",children:"phlow.yaml"}),"\n",(0,r.jsx)(n.p,{children:"This file describes the module's metadata, including its name, description, version, author, repository, license, type, and tags. It also defines the input schema for the module, specifying the required properties and their types."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"phlow.yaml"})," is required for Phlow to recognize the module. The file must contain the following information:"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Field"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Example"}),(0,r.jsx)(n.th,{children:"Type"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"name"}),(0,r.jsx)(n.td,{children:"Name of the module."}),(0,r.jsx)(n.td,{children:"my_module"}),(0,r.jsx)(n.td,{children:"string"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"description"}),(0,r.jsx)(n.td,{children:"Description of the module."}),(0,r.jsx)(n.td,{children:"This is my module"}),(0,r.jsx)(n.td,{children:"string"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"version"}),(0,r.jsx)(n.td,{children:"Version of the module."}),(0,r.jsx)(n.td,{children:"0.1.0 (major.minor.patch)"}),(0,r.jsx)(n.td,{children:"string"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"author"}),(0,r.jsx)(n.td,{children:"Author of the module."}),(0,r.jsxs)(n.td,{children:["John Doe <",(0,r.jsx)(n.a,{href:"mailto:email@email.c",children:"email@email.c"}),">"]}),(0,r.jsx)(n.td,{children:"string"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"repository"}),(0,r.jsx)(n.td,{children:"URL of the module's repository."}),(0,r.jsx)(n.td,{children:"github.com/my_repo/my_phlow"}),(0,r.jsx)(n.td,{children:"string"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"license"}),(0,r.jsx)(n.td,{children:"License of the module."}),(0,r.jsx)(n.td,{children:"MIT ou ./LICENSE"}),(0,r.jsx)(n.td,{children:"string ou path"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"type"}),(0,r.jsx)(n.td,{children:"Type of the module"}),(0,r.jsx)(n.td,{children:"step, main or any"}),(0,r.jsx)(n.td,{})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"tags"}),(0,r.jsx)(n.td,{children:"Tags associated with the module."}),(0,r.jsx)(n.td,{children:"[http, web, request]"}),(0,r.jsx)(n.td,{children:"array"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"input"}),(0,r.jsx)(n.td,{children:"Input schema of the module, defining the properties and their types."}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"#object-schema",children:"object schema"})}),(0,r.jsx)(n.td,{children:"object"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"output"}),(0,r.jsx)(n.td,{children:"Output schema of the module, defining the properties and their types."}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"#object-schema",children:"object schema"})}),(0,r.jsx)(n.td,{children:"object"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"with"}),(0,r.jsx)(n.td,{children:"Additional configurations for the module."}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"{database: postgres, username: postgres}"})}),(0,r.jsx)(n.td,{children:"object"})]})]})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"name: log\ndescription: Log a message to the console.\nversion: 0.0.1\nauthor: Philippe Assis <codephilippe@gmail.com>\nrepository: https://github.com/phlowdotdev/phlow\nlicense: MIT\ntype: step\ntags:\n  - log\n  - echo\n  - print\ninput: \n  type: object\n  required: true\n  properties:\n    level:\n      type: string\n      description: The log level (e.g., info, debug, warn, error).\n      default: info\n      required: false\n    message:\n      type: string\n      description: The message to log.\n      required: true\n"})}),"\n",(0,r.jsx)(n.h3,{id:"object-schema",children:"Object Schema"}),"\n",(0,r.jsxs)(n.p,{children:["The input and output schemas are defined using a format similar to ",(0,r.jsx)(n.a,{href:"https://json-schema.org/draft-07",children:"JSON Schema Draft 7"}),", with some additional properties such as ",(0,r.jsx)(n.code,{children:"default"}),". The ",(0,r.jsx)(n.code,{children:"input"})," schema specifies the expected input format for the module, while the ",(0,r.jsx)(n.code,{children:"output"})," schema defines the format of the output produced by the module."]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Field"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Value"}),(0,r.jsx)(n.th,{children:"Type"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"type"}),(0,r.jsx)(n.td,{children:"Type of the schema."}),(0,r.jsx)(n.td,{children:"object, array, number, string, boolean, null"}),(0,r.jsx)(n.td,{children:"string"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"properties"}),(0,r.jsx)(n.td,{children:"Properties of the object schema."}),(0,r.jsx)(n.td,{children:"object schema"}),(0,r.jsx)(n.td,{children:"object"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"required"}),(0,r.jsx)(n.td,{children:"Required properties of the object schema."}),(0,r.jsx)(n.td,{children:"array of strings"}),(0,r.jsx)(n.td,{children:"array"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"items"}),(0,r.jsx)(n.td,{children:"Items of the array schema."}),(0,r.jsx)(n.td,{children:"object schema"}),(0,r.jsx)(n.td,{children:"object"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"enum"}),(0,r.jsx)(n.td,{children:"Enum values of the schema."}),(0,r.jsx)(n.td,{children:"array of strings"}),(0,r.jsx)(n.td,{children:"array"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"default"}),(0,r.jsx)(n.td,{children:"Default value of the schema."}),(0,r.jsx)(n.td,{children:"any type"}),(0,r.jsx)(n.td,{children:"any"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"description"}),(0,r.jsx)(n.td,{children:"Description of the schema."}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"string"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"properties"}),(0,r.jsx)(n.td,{children:"Properties of the object schema."}),(0,r.jsx)(n.td,{children:"object schema"}),(0,r.jsx)(n.td,{children:"object"})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>i});var t=s(6540);const r={},l=t.createContext(r);function d(e){const n=t.useContext(l);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);